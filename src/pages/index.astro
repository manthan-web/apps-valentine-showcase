---
import { Image } from "astro:assets";
import { getEntry } from "astro:content";
import BaseLayout from "@/layouts/base.astro";

const { data } = await getEntry("loves", "main");
const {
  title,
  openingPhrase,
  acceptedPhrase,
  rejectionText,
  acceptText,
  pendingImage,
  acceptedImage,
  couplePhoto,
} = data;
---

<script>
  const main = document.getElementById("main") as HTMLDivElement;

  const headerInitial = document.getElementById(
    "header-initial",
  ) as HTMLDivElement;
  const headerYes = document.getElementById("header-yes") as HTMLDivElement;

  const btnGroup = document.getElementById("button-group") as HTMLDivElement;
  const btnYes = document.getElementById("btn-yes") as HTMLButtonElement;
  const btnNo = document.getElementById("btn-no") as HTMLButtonElement;

  let currentIndex = 0;
  const arrTextButtonNo = main.dataset.rejectionText?.split(",") ?? [];

  const toggleHeader = () => {
    headerInitial.classList.add("hidden");

    headerYes.classList.remove("hidden");
    headerYes.classList.add("flex");

    btnGroup.classList.add("hidden");

    currentIndex = 0;
    btnNo.textContent =
      arrTextButtonNo[currentIndex % arrTextButtonNo.length] ?? "";
  };

  const loopButtonText = () => {
    currentIndex += 1;
    btnNo.textContent =
      arrTextButtonNo[currentIndex % arrTextButtonNo.length] ?? "";

    btnYes.style.padding = `${1 + currentIndex * 0.2}rem ${
      1 + currentIndex * 0.4
    }rem`;
    btnYes.style.fontSize = `${3 + currentIndex * 0.2}rem`;
  };

  btnYes.addEventListener("click", toggleHeader);
  btnNo.addEventListener("click", loopButtonText);
</script>

<BaseLayout title={title}>
  <main
    class="w-full min-h-dvh flex flex-col gap-6 items-center justify-center p-4 bg-primary text-primary-mono"
    id="main"
    data-rejection-text={rejectionText}
  >
    <!-- Cute couple photo at the top -->
    {couplePhoto && (
      <div class="relative">
        <div class="absolute inset-0 bg-gradient-to-r from-secondary via-tertiary to-secondary rounded-full blur-xl opacity-50 animate-pulse"></div>
        <Image
          src={couplePhoto}
          alt="Us ðŸ’•"
          width={150}
          height={150}
          class="relative w-[150px] h-[150px] rounded-full object-cover border-4 border-primary-mono shadow-2xl"
        />
      </div>
    )}

    <section
      id="header-initial"
      class="flex flex-col gap-4 items-center justify-center"
    >
      <h1 class="text-6xl font-primary text-center">{openingPhrase}</h1>
      <Image
        src={pendingImage}
        alt={"Pending Image"}
        width={480}
        height={380}
        class="rounded-[2rem] mx-auto w-[480px] h-[380px]"
      />
    </section>

    <section
      id="header-yes"
      class="flex-col gap-4 items-center justify-center hidden"
    >
      <h1 class="text-6xl font-primary">{acceptedPhrase}</h1>
      <Image
        src={acceptedImage}
        alt="Accepted Image"
        width={480}
        height={380}
        class="rounded-[2rem] mx-auto w-[480px] h-[380px]"
      />
    </section>

    <section
      id="button-group"
      class="font-secondary flex flex-col gap-2 md:block items-center"
    >
      <button
        id="btn-yes"
        class="text-3xl py-2 px-8 rounded-xl bg-secondary hover:bg-secondary-mono transition-all duration-300 w-fit text-white font-bold shadow-lg hover:scale-105"
        >{acceptText}</button
      >
      <button
        id="btn-no"
        class="text-3xl py-2 px-8 rounded-xl bg-tertiary hover:bg-tertiary-mono transition-colors duration-300 w-fit text-white font-bold shadow-lg"
        >{rejectionText[0]}</button
      >
    </section>
  </main>
</BaseLayout>
